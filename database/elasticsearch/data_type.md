# 문자열 데이터 타입 
\#ElasticSearch \#검색 \#다중검색 

<br>

### 이 글에서 알고 싶은 내용 
- text 필드의 다중 검색 방법 
- text 필드를 index = false로 설정했던 인덱스를 true로 변경 후 색인했을때 성능 차이 

<br>

---

## 매핑 
: 필드 속성을 정의함

- 데이터 타입
- 메타데이터
- 매핑 파라미터 

<br>

### 매핑 파라미터 (주요한 것만)
- **analyzer** : 해당 필드 데이터를 형태소 분석하겠다. Text 데이터 타입의 필드의 경우 기본적으로 해당 파라미터를 사용해야하는데 디폴트로 Standard Analyzer로 형태소 분석을 수행한다.
- **doc_value** : 기본 캐시. Text 타입을 제외한 모든 타입에서 기본적으로 doc_values 캐시를 사용한다. 필드를 정렬, 집계할 필요가 없고 스크립트에서 필드 값에 엑세스할 필요가 없다면 비활성화할 수 있다. 그럼 디스크 공간을 절약할 수 있다.
- **index** : 필드값을 색인할지 결정, true가 기본값으로 비 색인 시 검색이 불가능하다.
- **field** : 필드 안에 또 다른 필드(다중 필드)에 대한 정보 설정
- **null_value** : ES는 색인 시 필드가 없거나 필드 값이 null인 경우, 필드를 생성하지 않는다. null_value를 설정하면 문서의 값이 null인 경우 해당 값으로 대체되어 색인된다.
- **store** : 필드 값을 필드와 별도로 _source에 저장하고 검색 가능하게 할지를 설정한다. (false)

<br> 

## keyword와 text 타입의 차이를 알아보자

### keyword
- 키워드 형태로 사용
- 분석기 미사용
- 검색 시 필터링되는 항목, 정렬이 필요한 항목, 집계해야 하는 항목

#### 검색
데이터가 “elastic search”인 경우, "elastic search" 라고 검색해야지만 결과로 노출된다. <br>
"elastic"이나 "elasticsearch"으로는 검색이 불가능하다. 

<br>

### text
- 지정된 분석기 사용 (Standard Analyzer)
- 문장 형태에 적합
- 전체 텍스트가 토큰화되어 생성 => 전문 검색 가능
- 정렬/집계가 필요한 경우 Keyword 타입 멀티 필드 설정 

<br>

#### 검색 방법
- 일반 검색 
```
GET INDEX명/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "name": "닭가슴살"
          }
        }
      ]
    }
  }
}
```

<br>

- 다중 검색 
```
GET INDEX명/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "match": {
            "name": "닭가슴살||닭안심||닭갈비"
          }
        }
      ]
    }
  }
}
```
